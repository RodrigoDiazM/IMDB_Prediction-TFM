<!DOCTYPE html>

<html lang="en">
    <head>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta charset="UTF-8">
        <title>Aplicacion</title>
    </head>

    <body>
        <div id ="gif"></div>
        <div class="col-md-12"><br></div>
        <div class="col-md-12"><br></div>
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" align="center">
                <div><h1>IMDB Prediction App</h1></div>
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-1"></div>
            
            
        </div>

        <div class="col-md-12"><br></div>
        <div class="col-md-12"><br></div>
        <div class="row">
            
            <div class="col-md-1"></div>
            <div class="col-md-3" align="center">

              <h4>Caratula de la pelicula</h4>
              <br><input type='file' accept='image/*' onchange='openFile(event)'><br>
              <br>
              <img id='output' style="height:268px; width:182px;">
              
            </div>


            <div class="col-md-4" align="center">
              <h4>Datos tabulares Categoricas</h4>
              <a href="https://drive.google.com/file/d/1tLmBldCAdl-Mu1NDVcQKo04OAbWGSi0P/view?usp=sharing" download>Link con los datos disponibles para introducir</a><br>
              <label for="duracion">Duración:</label><br>
              <input type="text" id="duracion" name="duracion"><br>

              <label for="anio">Año:</label><br>
              <input type="text" id="anio" name="anio"><br>

              <label for="color">Color:</label><br>
              <input type="text" id="color" name="color"><br>

              <label for="director">Director:</label><br>
              <input type="text" id="director" name="director"><br>

              <label for="pais">Pais:</label><br>
              <input type="text" id="pais" name="pais"><br>

              <label for="generos0">Generos(3 géneros ordenados por prioridad y separados por coma ):</label><br>
              <input type="text" id="generos0" name="generos0"><br>
              <label for="generos1">Generos 1:</label><br>
              <input type="text" id="generos1" name="generos1"><br>
              <label for="generos2">Generos 2:</label><br>
              <input type="text" id="generos2" name="generos2"><br>

              <label for="lenguaje">Lenguaje:</label><br>
              <input type="text" id="lenguaje" name="lenguaje"><br>

              <label for="keywords0">Keywords(3 keywords ordenadas por prioridad y separadas por coma):</label><br>
              <input type="text" id="keywords0" name="keywords0"><br>
              <label for="keywords1">Keywords 1:</label><br>
              <input type="text" id="keywords1" name="keywords1"><br>
              <label for="keywords2">Keywords 2:</label><br>
              <input type="text" id="keywords2" name="keywords2"><br>

              <label for="escritor">Escritor:</label><br>
              <input type="text" id="escritor" name="escritor"><br>

              <label for="content_rating">Content Rating:</label><br>
              <input type="text" id="content_rating" name="content_rating"><br>

              <label for="actores0">Actores 0(3 actores ordenados por prioridad y separados por coma):</label><br>
              <input type="text" id="actores0" name="actores0"><br>
              <label for="actores1">Actores 1:</label><br>
              <input type="text" id="actores1" name="actores1"><br>
              <label for="actores2">Actores 2:</label><br>
              <input type="text" id="actores2" name="actores2"><br>
            </div>

            <div class="col-md-3" align="center">

                <h4>Titulo y Descripcion</h4>
                <label for="titulo">Titulo:</label><br>
                <input type="text" id="titulo" name="titutlo"><br>
                <label for="Descripcion">Descripcion (EN INGLÉS):</label><br>
                <input type="text" id="Descripcion" name="Descripcion"><br>
    
            </div>
            <div class="col-md-1"></div>

        </div>
        <div class="col-md-12"><br></div>

        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" align="center">

                <h4>Seleccione los datos que desea para clasificar</h4>
                <select class="custom-select custom-select-lg mb-3" id="opcion" onchange="danio(this.value)">
                    <option value="" selected disabled hidden>Choose here</option>
                    <option value="1">Option 1: Img</option>
                    <option value="2">Option 2: Categorical Data</option>
                    <option value="3">Option 3: Img + Categorical Data</option>
                    <option value="4">Option 4: Título</option>                   
                    <option value="5">Option 5: Descripción en INGLÉS</option>
                </select>
    
           
                <button id="predict" class="btn btn-success">Predict</button>
            </div>
            <div class="col-md-4"></div>
        </div>
        <div class="col-md-12"><br></div>
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" align="center">
                <div>Para la Opción 2 y 3 las keywords de la descripción son:</div>
            </div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" align="center">
                <textarea id='keywords'></textarea>
            </div>
            <div class="col-md-4"></div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" align="center">
                <div>La salida de la red es:</div>
            </div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" align="center">
                <textarea id='inputArea'></textarea>
            </div>
            <div class="col-md-4"></div>
        </div>
        
        <style>
            #gif {
                background: url('https://i.stack.imgur.com/hzk6C.gif') no-repeat center center;
                position: absolute;
                top: 30%;
                left: 0; 
                height: 100%;
                width: 100%;
                z-index: 1;    
            }
            </style>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src ="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script>

            
            function hideLoader() {
                $('#gif').hide();
            }

            function showLoader() {
                $('#gif').show();
            }
            $(window).ready(hideLoader);
            // Para seleccionar la opcion 

            var typeaux;
            function danio(type){
                console.log(type);
                window.opcion = type;
            }       

            // Función para leer la imagen
            var openFile = function(file) {
                var input = file.target;

                var reader = new FileReader();
                reader.onload = function(){
                    var dataURL = reader.result;
                    var output = document.getElementById('output');

                    output.src = dataURL;
                    window.url_img = dataURL.replace("data:image/jpeg;base64,","")
                };
                reader.readAsDataURL(input.files[0]);
                            
            };

            // Función para enviar los datos a el fichero python
            
            $("#predict").click(function(event){

                $(window).ready(showLoader);
                
                var duracion = $("#duracion").val();
                var anio = $("#anio").val();
                var color = $("#color").val();
                var director = $("#director").val();
                var pais = $("#pais").val();
                var generos0 = $("#generos0").val();
                var generos1 = $("#generos1").val();
                var generos2 = $("#generos2").val();
                var generos = $("#generos").val();
                var lenguaje = $("#lenguaje").val();
                var keywords0 = $("#keywords0").val();
                var keywords1 = $("#keywords1").val();
                var keywords2 = $("#keywords2").val();
                var escritor = $("#escritor").val();
                var content_rating = $("#content_rating").val();
                var actores0 = $("#actores0").val();
                var actores1 = $("#actores1").val();
                var actores2 = $("#actores2").val();
                var titulo = $("#titulo").val();
                var descripcion = $("#Descripcion").val();

                console.log(titulo)
                console.log(descripcion)
                
                var data = {datos_categoricos: [color,director,generos0,generos1,generos2,lenguaje,pais,keywords0,keywords1,keywords2,escritor,content_rating,actores0,actores1,actores2,duracion,anio], url_img: window.url_img, opcion: window.opcion, titulo: titulo, Descripcion: descripcion};

                var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
                console.log(Descripcion)
                $.ajax({
                    type: "POST",
                    //url: $SCRIPT_ROOT + "/put_prediction/",
                    url: "/put_prediction/",	
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success: function(data){
                        var newText = data;
                            
                        if(window.opcion=="3" || window.opcion=="2"){
                            $("#keywords").val(newText[1]);
                            $("#inputArea").val(newText[0]);
                            $(window).ready(hideLoader);
                        }else{
                            $("#keywords").val("");
                            $("#inputArea").val(newText);
                            $(window).ready(hideLoader); 
                        }
                        
                    }
                });
                                
            });


        </script>


    </body>
</html>